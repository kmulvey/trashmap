DROP TABLE IF EXISTS areas;
DROP TABLE IF EXISTS users;

CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    email VARCHAR(128) NOT NULL UNIQUE,
    password_hash VARCHAR(44) NOT NULL,
    contact_allowed boolean DEFAULT false
);

CREATE TABLE areas (
    id SERIAL PRIMARY KEY,
    user_id SERIAL,
    polygon GEOMETRY,
    FOREIGN KEY (user_id) REFERENCES users(id)
);
CREATE INDEX areas_polygon_idx ON areas USING GIST (polygon);

INSERT INTO users (email, password_hash, contact_allowed) VALUES('me@site.com', 'fakehash', false);
-- insert boulder county
INSERT INTO areas (user_id, polygon) VALUES(1, ST_GeometryFromText('POLYGON((40.259822802779816 -105.65290936674407,40.26201885227386 -105.05519389236237,39.95833557541779 -105.05494458234654,39.93788639054093 -105.68899269947714,40.259822802779816 -105.65290936674407))'));
-- insert grand canyon
INSERT INTO areas (user_id, polygon) VALUES(1, ST_GeometryFromText('POLYGON((36.24244932613963 -112.40547934312802, 36.223086062103704 -111.81857028617547, 36.00588425331162 -111.83171900919251, 36.02265323852763 -112.34279966186926, 36.24244932613963 -112.40547934312802))'));
-- select within colorado
SELECT id, user_id, ST_AsText(polygon) FROM areas WHERE ST_Contains(ST_GeomFromText('POLYGON((40.99837454922104 -109.05421673800787, 41.0004139327614 -102.05758033526878, 37.015379641011805 -109.05244682441632, 37.004114233165524 -102.04615148062369, 40.99837454922104 -109.05421673800787))'), polygon); 
